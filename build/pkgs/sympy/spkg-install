#!/usr/bin/env bash

if [ "$SAGE_LOCAL" = "" ]; then
   echo "SAGE_LOCAL undefined ... exiting";
   echo "Maybe run 'sage -sh'?"
   exit 1
fi

cd src/

# Because sympy imports itself in setup.py we need to set PYTHONPATH
# to avoid loading the currently installed version.
echo "building sympy"
PYTHONPATH="." python setup.py build

if [ $? -ne 0 ]; then
   echo "Error building sympy"
   exit 1
fi

# Removing old sympy so that there are no leftover undesirable files,
# we do this in any python2 install.
if [ "$SAGE_ROOT" = "" ]; then
    echo "Please set the SAGE_ROOT variable"
    exit 1
fi
echo "Deleting $SAGE_ROOT/local/lib/python2.x/site-packages/sympy*"
rm -rf $SAGE_ROOT/local/lib/python2.*/site-packages/sympy*

if [ $? -ne 0 ]; then
   echo "Error removing old sympy"
   exit 1
fi

echo "installing sympy"
PYTHONPATH="." python setup.py install
